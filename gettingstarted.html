<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Snitch: JVM monitoring made painless</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/docs.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet">
  </head>

  <body onload="prettyPrint()">
    <!-- Navigation bar -->
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="index.html">Overview</a></li>
              <li class="active"><a>Getting Started</a></li>
              <li><a href="http://www.github.com/bazaarvoice/snitch">Github</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Getting Started</li>
              <li><a href="#maven">Maven setup</a></li>
              <li><a href="#annotations">Static annotations</a></li>
              <li><a href="#instances">Instance registration</a></li>
              <li><a href="#servlet">Servlet output</a></li>
            </ul>
          </div>
        </div>
        <div class="span10">
          <p id="maven">
            <h2>Maven setup</h2>
            Snitch is distributed through maven central.  To use it, just include it in your <code>pom.xml</code>.
            <p/>
            <pre class="prettyprint">
&lt;dependency&gt;
  &lt;groupId&gt;com.bazaarvoice.snitch&lt;/groupId&gt;
  &lt;artifactId&gt;snitch-core&lt;/artifactId&gt;
  &lt;version&gt;0.8.3&lt;/version&gt;
&lt;/dependency&gt;</pre>
          </p>
          
          <p id="annotations">
            <h2>Static annotations</h2>
            Using Snitch is incredibly easy.  In your code, mark the fields that you would like to be exposed by
            Snitch with the <code>@Monitored</code> annotation.  Snitch will then do all of the hard work in locating
            and exposing them at runtime.  The simplest case is when the field that is annotated is static.
            <p/>
            <pre class="prettyprint">
public class MyService {
  @Monitored
  private static final AtomicLong NUM_REQUESTS = new AtomicLong();
  
  public void handleRequest() {
    NUM_REQUESTS.incrementAndGet();
    // ... handle the request ...
  }
}
</pre>
            It's as simple as that.  Snitch will find the <code>NUM_REQUESTS</code> field at runtime and expose it's
            value to the outside world.  As the value contained in the field changes, so will the value that Snitch
            exposes.  In addition if you'd like to control the name that Snitch uses for the field, the 
            <code>@Monitored</code> annotation accepts an optional string argument that allows you to specify it.  
            Snitch will then use the specified name whenever it outputs the field.
            <p/>
            Snitch also works with annotated methods.  If a method is annotated with the <code>@Monitored</code> annotation
            then Snitch will expose the return value of that method to the outside world as well.  The annotated method
            must take no parameters and must not return void.  At runtime Snitch will retrieve a handle to the method and
            invoke it in order to retrieve its value.  The previous example could have been rewritten to use an annotated
            method instead of a field.
            <p/>
            <pre class="prettyprint">
public class MyService {
  private static final AtomicLong NUM_REQUESTS = new AtomicLong();

  @Monitored("number-of-handled-requests")
  public static void getNumRequests() {
    return NUM_REQUESTS.get();
  }
  
  public void handleRequest() {
    NUM_REQUESTS.incrementAndGet();
    // ... handle the request ...
  }
}
</pre>
          </p>
          
          <p id="instances">
            <h2>Instances with annotations</h2>
            Often times it's not possible to make all of the fields and methods that should be monitored by Snitch static.
            Snitch supports you in these cases as well and has the ability to work with non-statics as well.  It does
            however require a bit more work on your part.  In order to allow Snitch to see your instances you need to
            register them with Snitch using the <code>Snitch</code> class.
            <p/>
            <pre class="prettyprint">
public class MyService {
  private final AtomicLong numRequests = new AtomicLong();
  
  public MyService() {
    // Register my service with Snitch so it can find the non-static fields
    Snitch.getInstance().registerInstance(this);
  }
  
  public void handleRequest() {
    numRequests.incrementAndGet();
    // ... handle the request ...
  }
}
</pre>
            <p/>
          </p>
          
          <p id="servlet">
            <h2>Output using the Snitch servlet</h2>
            Snitch provides a servlet that can be used to view the values of methods and fields that are being monitored
            by Snitch.  In order to use the servlet, you must first update your <code>pom.xml</code> to include the
            <code>snitch-servlet</code> artifact.
            <p/>
            <pre class="prettyprint">
&lt;dependency&gt;
  &lt;groupId&gt;com.bazaarvoice.snitch&lt;/groupId&gt;
  &lt;artifactId&gt;snitch-servlet&lt;/artifactId&gt;
  &lt;version&gt;0.8.3&lt;/version&gt;
&lt;/dependency&gt;</pre>
</pre>
            <p/>
            Once you have the Snitch servlet jar available you can bind the 
            <code>com.bazaarvoice.snitch.servlet.VariableServlet</code> servlet to any path you choose.
            <p/>
            <span class="label label-important">Warning</span>
            The servlet can expose details of the system that may not be appropriate for end-users to see.  It is <i>strongly</i>
            recommended that the <code>VariableServlet</code> be accessible only via the LAN facing side of your production
            network.
            <p/>
            With the Snitch servlet in place you can navigate to it using any HTTP client to see the state of any monitored
            fields or methods in the system.  Here's what an example of Snitch output looks like.
            <p/>
            <pre class="prettyprint">
{
  "num-of-served-requests": 284818,
  "num-of-unhandled-exceptions": 12,
  "last-cache-refresh-time": "2012-01-09 08:39:42 CDT",
  "last-unhandled-exception": "java.lang.NullPointerException",
  "content-cache-statistics": {
    "hit-count": 20301,
    "miss-count": 294,
    "load-success-count": 293,
    "load-exception-count": 1,
    "total-load-time": 17234000,
    "eviction-count": 0
  }
}
</pre>
          </p>
        </div>
      </div>
      
      <div class="row-fluid">
          <!-- Footer -->
          <footer class="footer">
            <p>Created at <a href="http://developer.bazaarvoice.com/">Bazaarvoice</a>.</p>
           <p>
              Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License v2.0</a>. 
              Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
            </p>
          </footer>
        </div>
      </div>
    </div>
    
    <!-- Javascript, placed at the end of the document so the pages load faster -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/google-code-prettify/prettify.js"></script>
  </body>
</html>
